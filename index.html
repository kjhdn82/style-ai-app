<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <!-- ì•± ì„¤ì¹˜ìš© PWA ì„¤ì • -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#202124">
  <link rel="icon" href="icon-192.png">
  
  <title>ìŠ¤íƒ€ì¼ AI í‰ê°€</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 30px; }
    #preview { max-width: 300px; margin-top: 20px; display: block; margin: auto; }
    #result { margin-top: 25px; font-size: 1.2em; font-weight: bold; }
    #desc { margin-top: 10px; color: #555; font-size: 0.95em; }
  </style>
</head>
<body>
  <h1>ğŸ“¸ ë‚˜ì˜ ìŠ¤íƒ€ì¼ AI í‰ê°€</h1>
  <input type="file" accept="image/*" id="imageInput"><br>
  <img id="preview" src="" alt="ë¯¸ë¦¬ë³´ê¸°"><br>
  <button onclick="predictStyle()">ìŠ¤íƒ€ì¼ í‰ê°€í•˜ê¸°</button>
  <p id="result"></p>
  <p id="desc"></p>

  <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>

  <script>
    let model, labels;

    const scoreMap = {
      "ìºì£¼ì–¼": 65,
      "í¬ë©€": 90,
      "ìŠ¤íŠ¸ë¦¿": 70,
      "ë…¸ì¶œ ë§ì€ ìŠ¤íƒ€ì¼": 35,
      "ë³´ìˆ˜ì ì¸ ìŠ¤íƒ€ì¼": 95
    };

    const descMap = {
      "ìºì£¼ì–¼": "í¸ì•ˆí•˜ê³  ì¼ìƒì ì¸ ì¸ìƒì„ ì¤ë‹ˆë‹¤.",
      "í¬ë©€": "ê²©ì‹ ìˆê³  ë‹¨ì •í•œ ìŠ¤íƒ€ì¼ì´ì—ìš”.",
      "ìŠ¤íŠ¸ë¦¿": "ììœ ë¡­ê³  ê°œì„± ìˆëŠ” ë¶„ìœ„ê¸°ì˜ˆìš”.",
      "ë…¸ì¶œ ë§ì€ ìŠ¤íƒ€ì¼": "ëŒ€ë‹´í•˜ê³  ëˆˆê¸¸ì„ ë„ëŠ” ìŠ¤íƒ€ì¼ì´ì—ìš”.",
      "ë³´ìˆ˜ì ì¸ ìŠ¤íƒ€ì¼": "ë‹¨ì •í•˜ê³  ì •ì œëœ ì´ë¯¸ì§€ë¥¼ ì¤ë‹ˆë‹¤."
    };

    // ëª¨ë¸ ë° ë¼ë²¨ ë¡œë”©
    window.onload = async () => {
      model = await tf.loadLayersModel('./model/model.json');
      labels = await fetch('./model/labels.json').then(res => res.json());
      console.log("âœ… ëª¨ë¸ ë° ë¼ë²¨ ë¡œë”© ì™„ë£Œ");
    };

    // ì´ë¯¸ì§€ ì—…ë¡œë“œ
    document.getElementById('imageInput').addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        document.getElementById('preview').src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    // ìŠ¤íƒ€ì¼ ì˜ˆì¸¡
    async function predictStyle() {
      if (!model || !labels) {
        alert("ëª¨ë¸ì´ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ì–´ìš”.");
        return;
      }

      const image = document.getElementById('preview');
      if (!image.src || image.src.includes('blank')) {
        alert("ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”.");
        return;
      }

      const tensor = tf.browser.fromPixels(image)
        .resizeNearestNeighbor([224, 224])
        .toFloat()
        .div(tf.scalar(255))
        .expandDims(0);

      const preds = await model.predict(tensor).data();
      const maxIndex = preds.indexOf(Math.max(...preds));
      const label = labels[maxIndex];
      const score = scoreMap[label] ?? 50;
      const desc = descMap[label] ?? "";

      document.getElementById('result').innerText = `ì˜ˆì¸¡ëœ ìŠ¤íƒ€ì¼: ${label} (ì ìˆ˜: ${score}ì )`;
      document.getElementById('desc').innerText = desc;
    }
  </script>
</body>
</html>
